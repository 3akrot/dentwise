# DentWise Application Requirements

## Functional Requirements

| ID | Requirement | Testable Criteria |
|----|-------------|-------------------|
| **FR-1** | **User Authentication** — Users must be able to register and log in to the application using Clerk authentication. | **Test:** Given a new user visits `/dashboard`, when they are not logged in, then they should be redirected to the login page. When they successfully authenticate, they should be redirected to the dashboard. |
| **FR-2** | **Appointment Booking** — Authenticated users must be able to book appointments by selecting a doctor, date, time, and appointment type. | **Test:** Given an authenticated user on `/appointments`, when they select a doctor, choose a date/time, select an appointment type, and click confirm, then the appointment should be created in the database with status `CONFIRMED` and associated with the correct user and doctor. |
| **FR-3** | **View User Appointments** — Authenticated users must be able to view their upcoming appointments on the appointments page and dashboard. | **Test:** Given a user with 3 booked appointments, when they navigate to `/appointments`, then all 3 appointments should be displayed with doctor name, date, time, and reason. The appointments should be sorted by date ascending. |
| **FR-4** | **Doctor Availability Check** — The system must prevent double-booking by showing only available time slots for the selected doctor on a given date. | **Test:** Given a doctor has an appointment at 14:30 on 2025-12-15, when a user selects that doctor and date, then the 14:30 time slot should not be available for selection. |
| **FR-5** | **AI Voice Assistant (Pro Feature)** — Users with a "Pro" plan must be able to start a voice call with the AI dental assistant via VAPI integration. | **Test:** Given a user with `ai_basic` or `ai_pro` plan visits `/voice`, they should see the voice assistant UI. When they click "Start Call", the VAPI connection should be initiated and call status should change to "active". |
| **FR-6** | **Admin Doctor Management** — Admin users must be able to create, update, and view doctor records in the admin panel. | **Test:** Given an admin user (with email matching `ADMIN_EMAIL` env var) visits `/admin`, when they fill the "Add Doctor" form with valid data and submit, then a new doctor record should be created in the database with the specified name, email, specialty, and gender. |
| **FR-7** | **Email Confirmation** — When an appointment is successfully booked, a confirmation email should be sent to the user's email address. | **Test:** Given a user books an appointment successfully, when the booking is confirmed, then a POST request should be made to `/api/send-appointment-email` with the appointment details (user email, doctor name, date, time, type). |

---

## Non-Functional Requirements

| ID | Type | Requirement | Testable Criteria |
|----|------|-------------|-------------------|
| **NFR-1** | **Security** | Only authenticated users can access protected routes (`/dashboard`, `/appointments`, `/voice`, `/admin`). Admin routes must only be accessible to users whose email matches the configured `ADMIN_EMAIL` environment variable. | **Test 1:** Given an unauthenticated request to `/dashboard`, the middleware should redirect to the login page (verify 302/303 redirect response). **Test 2:** Given an authenticated non-admin user visits `/admin`, they should be redirected to `/dashboard`. **Test 3:** Given a user with email not matching `ADMIN_EMAIL` calls `createDoctor()` server action, the request should be rejected or the action should fail authorization. |
